# 02-1 이더넷

- 이더넷이라는 공통된 기술로 '물리 계층' - '데이터 링크 계층'은 서로 밀접하게 연관되어 있음.
- 이더넷 Ethernet : 현대 LAN, 특히 유선 LAN 환경에서 가장 대중적으로 사용되는 기술
  + 다양한 통신 매체의 규격들과 송수신되는 프레임의 형태, 프레임을 주고받는 방법 등이 정의된 네트워크 기술

## 이더넷 표준
- 오늘날 유선 LAN 환경은 대부분 이더넷을 기반으로 구성됨.
- 예시) 만약 유선 LAN 환경을 구축했다면, 물리 계층에서는 이더넷 규격 케이블, 데이터 링크 계층에서 주고받는 프레임은 이더넷 프레임의 형식을 따를 것임.
- 이더넷의 국제적 표준화 IEEE 802.3
  + 이더넷 관련 다양한 표준들의 모음을 의미하는 것.
  + 802.3, 802.3u, 802.3ab처럼 많은 표준이 있지만, 지원되는 네트워크 장비, 통신 매체의 종류와 전송 속도 등이 달라질 수 있다는 점

### 통신 매체 표기 형태
[전송 속도]BASE[-추가 특성]
- 1000BASE-LR4
  + 1000 : 전송 속도
  + R : 물리 계층에서의 인코딩 방식
  + 4 : 비트를 전송할 전송로(레인) 수


1. 전송 속도 data rate
- 숫자만 표기되어 있으면 Mbps 속도, 숫자 뒤에 G가 붙는 경우 Gbps 속도를 의미.

2. BASE (베이스밴드 BASEband)
- 베이스밴드 BASEband의 약자로, 변조 타입 modulation type을 의미
  + 변조 타입 : 비트 신호로 변환된 데이터를 통신 매체로 전송하는 방법을 의미
- (개발과는 다소 거리가 있음. 일반적인 LAN 환경에서는 디지털 신호를 송수신하는 베이스밴드 방식을 사용)

3. 추가 특성 addtional distinction
- 통신 매체의 특성을 명시함. (다양한 특성의 종류가 있음)
  + 전송 가능한 최대 거리
  + 물리 계층 인코딩 방식 (데이터가 비트 신호로 변환되는 방식)
  + 레인 수 (비트 신호를 옮길 수 있는 전송로 수를 의미)


### 통신 매체 종류
|추가 특성 표기(통신 매체의 종류)|케이블 종류|
|---|---|
|C|동축 케이블|
|T|트위스티드 페어 케이블|
|S|단파장 광섬유 케이블|
|L|장파장 광섬유 케이블|



## 이더넷 프레임 ethernet frame
![image](https://github.com/user-attachments/assets/1554974d-a2c5-41b0-9166-74daf8859f87)

- 헤더 : 프리앰블, 수신지 MAC 주소, 송신지 MAC 주소, 타입/길이
- 페이로드 : 데이터
- 트레일러 : FCS

### 프리앰블 preamble
- 프리앰블은 송수신지 간의 동기화를 위해 사용되는 정보
- 이더넷 프레임의 시작을 알리는 8바이트(64비트) 크기의 정보
- 첫 7바이트는 10101010 값을 가짐, 마지막 바이트는 101010**11** 값을 가짐 → 수신자는 이 프리앰블을 통해 이더넷 프레임이 오고 있음을 알아차림.

### 수신지 MAC 주소와 송신지 MAC 주소
- MAC 주소 '물리적 주소' : 네트워크 인터페이스마다 부여되는 6바이트(48비트) 길이의 주소로, LAN 내의 수신지와 송신지를 특정 가능함.
- *일반적*으로 고유하고, 변경되지 않는 주소로써 네트워크 인터페이스마다 부여됨. (NIC, Network Interface Controller라는 장치가 네트워크 인터페이스 역할을 담당함)
  + 한 컴퓨터에 NIC가 여러 개 있다면 MAC주소도 여러 개임.
 
### 타입 type / 길이 length
- 필드에 명시된 크기가 1500(16진수 05DC) 이하일 경우 : 해당 필드는 프레임의 크기(길이)를 나타내는 데 사용
- 필드에 명시된 크기가 1536(16진수 0600) 이상일 경우 : 해당 필드는 타입을 나타내는 데 사용

|타입|프로토콜|
|---|---|
|0800|IPv4|
|86DD|IPv6|
|0806|ARP|

### 데이터
- 네트워크 계층의 데이터와 헤더를 합친 PDU가 포함됨. (최대 크기 1500바이트, 최소 46바이트 이상)
  + 패딩 padding : 그 이하 데이터라면 크기를 맞추기 위해 정보가 내부에 0으로 채워짐.
 
### FCS, Frame Check Sequence
- 수신한 이더넷 프레임에 오류가 있는지 확인하기 위한 필드. CRC 값이 들어감
  + 데이터 링크 계층에서 오류 검출이 이루어지기도 하는데 이때 사용됨.
- CRC, Cyclic Redundancy Check (순환 중복 검사) : 오류 검출용 값
  + 송신지는 프리앰블을 제외한 나머지 필드 값들을 바탕으로 CRC 값을 계산한 후, 이 값을 FCS 필드에 명시함.
  + 수신지는 수신한 프레임에서 프리앰블과 FCS 필드를 제외한 나머지 필드 값들을 바탕으로 CRC 값을 계산한 뒤, 이 값을 FCS 필드 값과 비교함. => 비교 값이 일치하지 않다면, 오류가 있다고 판단하여 해당 프레임을 폐기함.
 
## 토큰 링 Token Ring
- 호스트들이 링(고리) 형태로 연결됨.
- 호스트끼리 돌아가며 토큰이라는 특별한 정보를 주고받음
  + 네트워크 내 다른 호스트에게 메시지를 송신하려면 반드시 이 토큰을 가지고 있어야 함.
  + ![image](https://github.com/user-attachments/assets/28fd3182-2336-4480-a73c-c80e8ca436b5)

  
# 02-2 NIC와 케이블
- NIC, Network Interface Controller : 호스트와 통신 매체를 연결하고, MAC 주소가 부여되는 네트워크 장비
  + 물리 계층의 유선 통신 매체인 케이블로 연결됨.
  + 케이블의 종류 : 트위스티드 페어 케이블 / 광섬유 케이블

## NIC
- 통신 매체를 통해 전달되는 신호와 컴퓨터가 이해할 수 있는 정보 간에 변환이 이루어져야 함 -> 변환을 담당하는 네트워크 장비가 NIC
- 네트워크 인터페이스 역할 (네트워크와의 연결점을 담당)
  + 통신 매체에 흐르는 신호 ↔ 호스트가 이해하는 프레임
- MAC 주소를 통해 자기 주소는 물론, 수신되는 프레임의 수신지 주소를 인식함. 그래서 어떤 프레임이 자신에게 도달했을 때 자신과는 관련 없는 수신지 MAC 주소가 명시된 프레임이라면 폐기할 수 있고, FCS 필드를 토대로 오류를 검출해 잘못된 프레임을 폐기할 수도 있음.

## 트위스티드 페어 케이블, twisted pair cable
- 구리 선으로 전기 신호를 주고받는 통신 매체. (대표적인 LAN 케이블)
- 케이블 본체(구리 선 두 가닥씩 꼬아져 있음) - 커넥터(RJ-45)로 이루어져 있음.
  + 구리 선으로 이루어져있기 때문에 전자적 간섭이 생길 수 있음 (노이즈)
  + 따라서 구리 선을 그물 모양의 철사/포일로 감싸 보호하는 경우가 많음. (차폐-브레이드 실드/포일 실드)
  + 실드에 따른 트위스티드 페어 케이블의 분류
    * STP, Shielded Twisted Pair 케이블 : 브레이드 실드(그물철사)
    * FTP, Foil Twisted Pair 케이블 : 포일 실드(포일)
    * UTP, Unshieled Twisted Pair 케이블 : 차폐X
  + 케이블 외부를 감싸는 실드의 종류
    * S : 브레이드 실드로 외부 보호
    * F : 포일 실드로 감쌈
    * SF : 브레이드 실드, 포일 실드로 감쌈
    * U : 아무것도 감싸지 않음
  + `케이블외부실드/구리선실드`로 명시
    * S/FTP, F/FTP, SF/FTP, U/UTP 등 ..

### 카테고리에 따른 트위스티드 페어 케이블의 분류
- 카테고리 : 트위스티드 페어 케이블 성능의 등급을 구분하는 역할
  + 높은 카테고리에 속한 케이블일수록 높은 성능을 보임 (Cat5 ~)
  + 송수신 데이터 양이 더 많고, 더 빠른 전송이 가능함.


## 광섬유 케이블, fiber optic cable
- 빛(광신호)를 이용해 정보를 주고 받음. 빛을 이용해 전송하기에 전기 신호를 이용하는 케이블에 비해 속도도 빠르고, 먼 거리까지 전송이 가능함.
- 노이즈로부터 간섭받는 영향도 적음 (따라서 대륙 간 연결에도 사용됨)
- 케이블 본체 - 커넥터로 이루어져 있음
  * 커넥터 종류 : LC, SC, FC, ST
  * 광섬유 중심 : 코어 core 존재. 실질적으로 빛이 흐르는 부분
    + 코어를 둘러싸는 클래딩 cladding 존재. (코어 안에서만 흐르도록 빛을 가두는 역할을 함)
    + 코어-클래딩 간 빛의 굴절률 차이를 만들어 빛을 코어 내부에 가두는 원리

### 싱글 모드 광섬유 케이블 SMF; Single Mode Fiber
- 코어의 지름이 8~10μm
  + 지름이 작기 때문에 빛이 이동할 수 있는 경로가 많지 않음 -> 이동 경로가 하나 이상을 갖기 어렵고, 이를 두고 '모드가 하나'라고 표현.
- 신호 손실이 적기에 장거리 전송에 적합. (수십 킬로미터)
  + 파장이 긴 장파장의 빛을 사용함.
- 멀티 모드에 비해 일반적으로 비용이 높다는 단점도 있음.

### 멀티 모드 광섬유 케이블 MMF; Multi Mode Fiber
- 코어의 지름이 50~62.5μm
  + 빛이 여러 경로로 이동할 수 있고, 이를 두고 '모드가 여러 개'라고 표현.
- 신호 손실이 클 수 있기에 장거리 전송에 부적합. (수 킬로미터)
  + 비교적 파장이 짧은 단파장의 빛을 사용함

# 02-3 허브
- 허브 : 물리 계층 네트워크 장비.
- 스위치 : 데이터 링크 계층 네트워크 장비.


## 주소 개념이 없는 물리 계층
- 물리 계층 : 주소 개념이 존재X
  + 단지 호스트와 통신 매체 간의 연결과 통신 매체상의 송수신이 이루어질 뿐.
  + 물리 계층의 네트워크 장비는 송수신되는 정보에 대한 어떠한 조작이나 판단을 하지 않음.
- 데이터 링크 계층 : 송수신지를 특정할 수 있는 주소를 가지기 시작함 (MAC주소)
  + MAC주소로 데이터 링크 계층 이상 계층은 송수신지를 특정할 수 있음
  + 주소를 바탕으로 송수신되는 정보에 대한 조작과 판단 가능

## 허브
- 허브 hub / 리피터 허브 repeater hub : 여러 대의 호스트를 연결하는 장치
### 허브의 특징
1. 전달받은 신호를 다른 모든 포트로 그대로 다시 내보냄
- 허브는 물리 계층에 존재 : 물리 계층에선 주소 개념이 없음. 따라서 수신자를 특정할 수 없음.
- 그러므로 신호를 전달밥ㄷ으면 어떠한 조작이나 판단을 하지 않고 송신지를 제외한 모든 포트에 내보내기만 함. → 이 신호를 전달받은 호스트는 데이터 링크 계층에서 MAC주소를 확인하고, 필요 없으면 폐기함.
2. 반이중 (half duplex) 모드로 통신함
- 반이중 모드 : 송수신을 번갈아 가면서 하는 통신 방식 (왕복 1차선 도로)
- 전이중 모드 (full duplex) : 송수신을 동시에 양방향으로 할 수 있는 통신 방식 (왕복 2차선 도로)
### 콜리전
![image](https://github.com/user-attachments/assets/332ef872-ec65-4f35-8a08-bc61fcc65935)
- 충돌collision : 동시에 허브에 신호를 송신하면, 두 신호가 충돌하면서 콜리전 발생. (반이중 모드이므로 하나밖에 못함)
- 콜리전 도메인 : 충돌이 발생할 수 있는 영역. (허브에 연결된 모든 호스트는 같은 콜리전 도메인에 속함) → 넓은 콜리전 도메인을 줄이기 위해 CSMA/CD 프로토콜을 사용하거나 스위치 장비를 사용함.
### CSMA/CD (Carrier Sense Multiple Access with Collision Detection)
- 특징
  1. Carrier sense 캐리어 감지
  - 메시지를 보내기 전에 현재 네트워크 상에서 전송 중인 것이 있는지는를 확인하는 것. (현재 통신 매체의 사용 가능 여부 검사)
  2. Multiple Access 다중 접근
  - 캐리어 감지를 함에도 불구, 두 개 이상의 호스트가 동시에 네트워크를 사용할 수도, 이를 다중 접근 상황이라고 함.
  3. Collision Detection 충돌 검출
  - 충돌을 감지하면 전송이 중단되고, 충돌을 검출한 호스트는 다른 이들에게 충돌이 발생했음을 알리고자 잼 신호(jam signal)라는 특별한 신호를 보냄. 그리고 임의 시간 동안 기다린 후 다시 전송.
- 순서
  1. 먼저 현재 전송이 가능한 상태인지를 확인하고,
  2. 다른 호스트가 전송 중이지 않을 때 메시지를 전송합니다.
  3. 만일 부득이하게 다수의 호스트가 접근하여 충돌이 발생하면 임의의 시간만큼 대기한 후에 다시 전송합니다.


# 02-4 스위치
- CSMA/CD를 통해 충돌 문제를 어느 정도 완화할 수는 있지만, 이보다 더 근본적인 해결 방법이 있음.
- 전달받은 신호를 수신지 호스트가 연결된 포트로만 내보내고, 전이중 모드로 통신하면 됨. → 포트별로 콜리전 도메인이 나누어지기에 충돌 위험이 감소함 → 해당 기능을 지원하는 네트워크 장비가 데이터 링크 계층의 "스위치"
  + 스위치가 전달받은 신호를 원하는 포트로만 내보낼 수 있는 것은 스위치가 MAC 주소를 학습할 수 있기 때문임!
  + 또한 스위치를 이용하며 논리적으로 LAN을 분리하는 가상의 LAN, VLAN을 구성하는 장점 존재
  
## 스위치 switch
- 데이터 링크 계층의 네트워크 장비 (2계층에서 사용하여 L2 스위치라고도 부름)
- 스위치의 여러 포트에는 호스트를 연결할 수 있음.
- 허브와는 달리 MAC 주소를 학습해 특정 MAC 주소를 가진 호스트에만 프레임을 전달할 수 있음. → 포트별로 콜리전 도메인이 나뉨
- 전이중 모드의 통신을 지원함. → CSMA/CD 프로토콜이 필요하지 않음
- → CSMA/CD 프로토콜의 대기 시간이 없어지므로 성능상의 이점도 생김!

### MAC 주소 학습, MAC address learning
- 특정 포트와 해당 포트에 연결된 호스트의 MAC 주소와의 관계를 기억하여, 원하는 호스트에만 프레임을 전달.
- MAC 주소 테이블, MAC address table : 스위치의 포트와 연결된 호스트의 MAC 주소 연관 관계를 나타내는 정보
  + 이를 통해 MAC 주소를 학습하여 원하는 포트로 패킷을 포워딩하고, 원치 않은 포트는 필터링할 수 있음.
- 주소 학습 : 프레임 내 '송신지 MAC 주소' 필드를 바탕으로 이루어짐. → 호스트에게 프레임을 수신받으면 적혀있는 MAC주소를 통해 MAC 주소 테이블에 기록함.
1. 플러딩flooding
- (호스트A를 찾기 위해) 허브처럼 송신지 포트를 제외한 모든 포트로 프레임을 전송하는 것을 말함.
- 호스트A는 스위치로 응답 프레임을 전송함. 해당 프레임에는 '송신지 MAC 주소' 필드가 존재하고 호스트A의 주소가 명시되어 있음. 이를 통해 MAC 주소 테이블에 기록함.
2. 포워딩forwarding과 필터링filtering
- 필터링 : 전달받은 프레임을 어디로 내보내고 어디로 내보내지 않을지 결정하는 스위치의 기능. 비유하자면 프레임을 내보낼 포트만을 제외, 다른 모든 포트를 가리개로 가는 것과 유사함.
- 포워딩 : 프레임이 전송될 포트에 실제로 프레임을 내보내는 것
- 예시) 호스트 A가 호스트 C에게 프레임을 전송하면 스위치는 플러딩을 통해 호스트C의 MAC 주소를 기록하고, 호스트 B, D가 연결된 포트로는 내보내지 않도록 필터링하고, 호스트 C가 연결된 포트로 프레임을 포워딩함.
3. 에이징aging
- 만약 MAC 주소 테이블에 등록된 특정 포트에서 일정 시간 동안 프레임을 전송받지 못했다면 해당 항목은 삭제됨.
- 예시) 일정 시간 동안 '송신지 MAC 주소'가 aa:aa:aa:aa:00:01인 프레임을 1번 포트에서 전송받지 못했다면 해당 항목을 삭제됨

### 브리지
- 스위치와 유사한 장비. 브리지는 네트워크 영역을 구획하여 콜리전 도메인을 나누거나 네트워크를 확장하는 용도로 사용함.
- 스위치 기능처럼 MAC 주소를 학습하고, 특정 호스트가 연결되어 있는 포트로 프레임을 포워딩하거나 필터링함.
- 다만, 단일 장비로서는 사용 빈도가 줄어들 고 있음. 브리지를 이용한 네트워킄 구획 및 확장은 스위치를 통해서도 얼마든지 가능하며, 최근 스위치의 기능은 일반적으로 브리지의 기능을 포괄할 뿐 아니라 더 다양하며, 프레임의 처리 성능 면에서도 우수하기 때문.

### VLAN, Vritual LAN
![image](https://github.com/user-attachments/assets/bacb32a7-9f42-4132-986a-f3f5ab99f903)

- 한 대의 스위치로 가상의 LAN을 만드는 방법
- 허브는 송신지 포트를 제외한 모든 포트로 신호를 내보내기에 네트워크상에 불필요한 트래픽이 늘어날 수밖에 없고, 성능 저하로 이어짐.
  + 스위치 또한 마찬가지. 스위치에 연결된 호스트 중에서도 서로 메시지를 주고받을 일이 적거나 브로드캐스트 메시지를 받을 필요가 없어서 굳이 같은 네트워크(LAN)에 속할 필요가 없는 호스트가 있을 수도 있음.
  + 해당 호스트들을 분리하고자 매번 새로운 스위치 장비를 구비하는 것은 낭비임. 이때 구성하는 것이 VLAN.
- VLAN을 구성하면 한 대의 물리적 스위치라 해도 여러 대의 스위치가 있는 것처럼 논리적인 단위로 LAN을 구획할 수 있음. (물리적 위치와 관계없이 논리적인 LAN을 구성할 수 있음)
- 만약 VLAN1에 속한 호스트가 VLAN2에 속한 호스트와 통신하고자 한다면 데이터 링크 계층의 장비가 아니라 **네트워크 계층 이상의 상위 계층 장비가 필요**함! (브로드캐스트 도메인도 달라짐)

### 1. 포트 기반 VLAN (Port based VLAN)
- 포트 기반 VLAN (port based VLAN)
  + 스위치의 포트가 VLAN을 결정하는 방식
  + 사전에 특정 포트에 VLAN을 할당하고, 해당 포트에 호스트를 연결함으로써 VLAN에 포함시킬 수 있음.
- VLAN Trunking 트렁킹
  + ![image](https://github.com/user-attachments/assets/9e1e7f83-2713-40de-a4a2-03d730e07d53)

  + 두 대 이상의 VLAN 스위치를 효율적으로 연결하여 확장하는 방법.
  + 스위치 간의 통신을 위한 특별한 포트(트렁크 포트)에 VLAN 스위치를 서로 연결하는 방식!
    * 트렁크 포트/태그 포트 ↔ 액세스 포트(하나의 VLAN이 할당된 일반적인 포트)
  + 낭비되는 포트를 최소하하며, 같은 스위치에 연결되어 있지 않아도 같은 LAN에 속하게 네트워크를 구성할 수 있게 됨.
  + 트렁크 포트로 전달받은 프레임이 어떤 VLAN에 속하는지 파악하는 방법
    * 프레임이 스위치 A에서 트렁크 포트를 타고 스위치 B로 넘어왔다고 가정
    * 스위치 B는 트렁크 포트로 전달받은 프레임이 어떤 VLAN에 속하는지 어떻게 알까? (학습되지 않은 MACc주소를 포함하고 있을 경우 이더넷 프레임만으론 알 수 없음)
    * 어떤 VLAN에 속하는지 식별하기 위한 정보까지 추가된 확장 이더넷 프레임을 사용함! `802.1Q 프레임`
    * ![image](https://github.com/user-attachments/assets/0c24de9a-471e-4226-be1f-ddf712e15c64)

### 1. MAC 기반 VLAN (MAC based VLAN)
- 설정된 MAC 주소에 따라 VLAN이 결정되는 MAC 기반 VLAN
- 포트가 VLAN을 결정하는 것이 아니라, 송수신하는 프레임 속 MAC 주소가 호스트가 속할 VLAN을 결정하는 방식.
- ![image](https://github.com/user-attachments/assets/8de8447f-c13a-443e-a1bf-96db2efc4e6e)






